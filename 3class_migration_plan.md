# 3 Class êµ¬ì„± ì „í™˜ ê³„íš

## í˜„ì¬ ìƒí™© (2 Class)

| í´ë˜ìŠ¤ ID | í´ë˜ìŠ¤ëª… | ì„¤ëª… |
|-----------|----------|------|
| 0 | helmet | í—¬ë©§ ì°©ìš© |
| 1 | vest | ì•ˆì „ì¡°ë¼ ì°©ìš© |

**ë¬¸ì œì :**
- í—¬ë©§ ë¯¸ì°©ìš© ìƒíƒœ ë¯¸íƒì§€
- ì•ˆì „ì¡°ë¼ ë¯¸ì°©ìš© ì—¬ë¶€ ì •í™•í•œ íŒë‹¨ ë¶ˆê°€
- ì‹¤ì œ ì•ˆì „ ëª¨ë‹ˆí„°ë§ ì‹œ ì°©ìš©/ë¯¸ì°©ìš© ëª¨ë‘ í•„ìš”

---

## ëª©í‘œ êµ¬ì„± (3 Class)

### ì˜µì…˜ 1: Helmet ì„¸ë¶„í™” (ê¶Œì¥)

| í´ë˜ìŠ¤ ID | í´ë˜ìŠ¤ëª… | ì„¤ëª… |
|-----------|----------|------|
| 0 | helmet | í—¬ë©§ ì°©ìš© âœ… |
| 1 | head | í—¬ë©§ ë¯¸ì°©ìš© (ë¨¸ë¦¬ë§Œ) âš ï¸ |
| 2 | vest | ì•ˆì „ì¡°ë¼ ì°©ìš© âœ… |

**ì¥ì :**
- Dataset 1(Hard Hat Detection)ì— head í´ë˜ìŠ¤ ì´ë¯¸ ì¡´ì¬
- í—¬ë©§ ì°©ìš©/ë¯¸ì°©ìš© ëª…í™•íˆ êµ¬ë¶„ ê°€ëŠ¥
- ì‹¤ì§ˆì ì¸ ì•ˆì „ ëª¨ë‹ˆí„°ë§ ê°€ëŠ¥

**ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤:**
- helmet íƒì§€ â†’ ì•ˆì „ âœ…
- head íƒì§€ â†’ ê²½ê³  ì•Œë¦¼ âš ï¸
- vest íƒì§€ â†’ ì•ˆì „ âœ…

### ì˜µì…˜ 2: Person ì¶”ê°€

| í´ë˜ìŠ¤ ID | í´ë˜ìŠ¤ëª… | ì„¤ëª… |
|-----------|----------|------|
| 0 | helmet | í—¬ë©§ ì°©ìš© |
| 1 | vest | ì•ˆì „ì¡°ë¼ ì°©ìš© |
| 2 | person | ì‚¬ëŒ ì „ì²´ |

**ì¥ì :**
- vest ë¯¸ì°©ìš© íŒë‹¨ ê°€ëŠ¥ (person - vest)
- Dataset 1ì— person í´ë˜ìŠ¤ ì¡´ì¬

**ë‹¨ì :**
- í—¬ë©§ ë¯¸ì°©ìš© ì—¬ì „íˆ ë¯¸íƒì§€
- personê³¼ helmet/vest ê°„ ê´€ê³„ ì²˜ë¦¬ ë³µì¡

---

## ì „í™˜ ì‘ì—… ìˆœì„œ

### Phase 1: ë°ì´í„° ì¬êµ¬ì„± ğŸ“Š

#### 1-1. ì›ë³¸ ë°ì´í„° ë°±ì—…
```bash
# í˜„ì¬ 2 class ë°ì´í„° ë°±ì—…
cp -r dataset/data dataset/data_backup_2class

# í˜„ì¬ ì„¤ì • íŒŒì¼ ë°±ì—…
cp configs/ppe_dataset.yaml configs/ppe_dataset_2class.yaml.bak
```

#### 1-2. í´ë˜ìŠ¤ ë§¤í•‘ ì¬ì •ì˜
```python
# src/1_preprocess/step3_merge_datasets.py ìˆ˜ì •
# 3 class ë§¤í•‘ìœ¼ë¡œ ë³€ê²½

class_mapping = {
    'dataset1': {
        'helmet': 0,      # í—¬ë©§ ì°©ìš©
        'head': 1,        # í—¬ë©§ ë¯¸ì°©ìš© (ì¶”ê°€)
        'vest': 2,        # ì•ˆì „ì¡°ë¼ (ë³€ê²½: 1 â†’ 2)
        'person': None    # ì œì™¸ (ë˜ëŠ” 2ë¡œ ë³€ê²½)
    },
    'dataset2': {
        'Safety-Helmet': 0,
        'Reflective-Jacket': 2  # ë³€ê²½: 1 â†’ 2
    }
}
```

#### 1-3. ë°ì´í„° ì¬ì „ì²˜ë¦¬
```bash
# Step 1: Dataset 1 ì¬ë³€í™˜ (head í´ë˜ìŠ¤ í¬í•¨)
uv run python src/1_preprocess/step1_convert_voc_to_yolo.py

# Step 2: Dataset 2 í™•ì¸ (ë³€ê²½ ì—†ìŒ, í´ë˜ìŠ¤ IDë§Œ ì¡°ì •)
uv run python src/1_preprocess/step2_check_dataset2.py

# Step 3: 3 class ë§¤í•‘ìœ¼ë¡œ í†µí•©
uv run python src/1_preprocess/step3_merge_datasets.py

# Step 4: Train/Val/Test ì¬ë¶„í• 
uv run python src/1_preprocess/step4_split_dataset.py

# Step 5: 3 class YAML ìƒì„±
uv run python src/1_preprocess/step5_generate_yaml.py

# Step 6: ë°ì´í„° ê²€ì¦
uv run python src/1_preprocess/step6_validate_dataset.py
```

---

### Phase 2: ì„¤ì • íŒŒì¼ ì—…ë°ì´íŠ¸ âš™ï¸

#### 2-1. configs/ppe_dataset.yaml
```yaml
path: /absolute/path/to/SafetyVisionAI/dataset/data
train: train/images
val: val/images
test: test/images

nc: 3  # ë³€ê²½: 2 â†’ 3
names:
  0: helmet
  1: head    # ì¶”ê°€
  2: vest    # ë³€ê²½: 1 â†’ 2
```

#### 2-2. configs/train_config.yaml
```yaml
# í´ë˜ìŠ¤ ìˆ˜ ì¦ê°€ë¡œ ì¼ë¶€ íŒŒë¼ë¯¸í„° ì¡°ì • í•„ìš”
model: yolov8n.pt
epochs: 100
batch_size: 128  # GPU ë©”ëª¨ë¦¬ í—ˆìš© ì‹œ ìœ ì§€
imgsz: 640
lr0: 0.01
patience: 50  # ì¡°ê¸° ì¢…ë£Œ patience
```

---

### Phase 3: ë°ì´í„° ê²€ì¦ âœ…

#### 3-1. í´ë˜ìŠ¤ ë¶„í¬ í™•ì¸
```bash
# ê° í´ë˜ìŠ¤ë³„ ê°ì²´ ìˆ˜ í™•ì¸
uv run python src/1_preprocess/step6_validate_dataset.py
```

**ì˜ˆìƒ ê²°ê³¼:**
| í´ë˜ìŠ¤ | Train | Val | Test | í•©ê³„ |
|--------|-------|-----|------|------|
| helmet | ~27,000 | ~6,000 | ~6,000 | ~39,000 |
| head | ~? | ~? | ~? | ~? |
| vest | ~11,000 | ~2,300 | ~2,400 | ~16,000 |

#### 3-2. ìƒ˜í”Œ ì´ë¯¸ì§€ ì‹œê°í™”
```python
# 3 class ë¼ë²¨ ì‹œê°í™” í™•ì¸
# - helmet: íŒŒë€ìƒ‰ ë°•ìŠ¤
# - head: ë¹¨ê°„ìƒ‰ ë°•ìŠ¤ (ê²½ê³ )
# - vest: ì´ˆë¡ìƒ‰ ë°•ìŠ¤
```

---

### Phase 4: ëª¨ë¸ ì¬í›ˆë ¨ ğŸš€

#### 4-1. í•™ìŠµ í™˜ê²½ ì„ íƒ

**ë¡œì»¬ MacBook (í…ŒìŠ¤íŠ¸ìš©)**
```bash
# 3 epoch í…ŒìŠ¤íŠ¸ í›ˆë ¨
uv run python src/2_training/train.py \
  --data configs/ppe_dataset.yaml \
  --epochs 3 \
  --batch 16 \
  --device mps
```

**RunPod A100 (ë³¸ í›ˆë ¨)**
```bash
# 100 epoch ì „ì²´ í›ˆë ¨
uv run python src/2_training/train.py \
  --data configs/ppe_dataset.yaml \
  --epochs 100 \
  --batch 128 \
  --device 0
```

#### 4-2. ì˜ˆìƒ í›ˆë ¨ ì‹œê°„
- A100 GPU: ì•½ 60-70ë¶„ (3 class ì¶”ê°€ë¡œ ì•½ê°„ ì¦ê°€)
- MacBook M1/M2: í…ŒìŠ¤íŠ¸ í›ˆë ¨(3 epochs) ì•½ 10-15ë¶„

---

### Phase 5: ì„±ëŠ¥ í‰ê°€ ğŸ“ˆ

#### 5-1. ëª©í‘œ ì„±ëŠ¥ ì§€í‘œ

| ì§€í‘œ | 2 Class (í˜„ì¬) | 3 Class (ëª©í‘œ) |
|------|----------------|----------------|
| mAP@0.5 | 94.4% | â‰¥ 90% |
| mAP@0.5:0.95 | 73.1% | â‰¥ 70% |
| Precision | 92.2% | â‰¥ 88% |
| Recall | 89.1% | â‰¥ 85% |

**ì°¸ê³ :** í´ë˜ìŠ¤ ì¶”ê°€ë¡œ ì•½ê°„ì˜ ì„±ëŠ¥ í•˜ë½ ì˜ˆìƒ, í•˜ì§€ë§Œ ì‹¤ìš©ì„± í–¥ìƒ

#### 5-2. í´ë˜ìŠ¤ë³„ ì„±ëŠ¥ ë¶„ì„
```bash
# í›ˆë ¨ ì™„ë£Œ í›„ ê²°ê³¼ ë¶„ì„
# models/ppe_detection_3class/results.png
# models/ppe_detection_3class/confusion_matrix.png
```

**ì¤‘ìš” í™•ì¸ ì‚¬í•­:**
- helmet vs. head í˜¼ë™ë¥  (ë†’ìœ¼ë©´ ë¬¸ì œ)
- head í´ë˜ìŠ¤ Recall (ë¯¸íƒì§€ìœ¨ ë‚®ì•„ì•¼ í•¨)
- vest ì„±ëŠ¥ ìœ ì§€ ì—¬ë¶€

---

### Phase 6: ì¶”ë¡  ì‹œìŠ¤í…œ ì—…ë°ì´íŠ¸ ğŸ”

#### 6-1. ì¶”ë¡  ìŠ¤í¬ë¦½íŠ¸ ìˆ˜ì •
```python
# src/3_inference/inference.py
# 3 class ìƒ‰ìƒ ì½”ë“œ ì •ì˜

CLASS_COLORS = {
    0: (0, 255, 0),    # helmet - ì´ˆë¡ìƒ‰ (ì•ˆì „)
    1: (0, 0, 255),    # head - ë¹¨ê°„ìƒ‰ (ìœ„í—˜)
    2: (255, 165, 0)   # vest - ì£¼í™©ìƒ‰ (ì•ˆì „)
}

# ê²½ê³  ë¡œì§ ì¶”ê°€
if class_id == 1:  # head íƒì§€
    print(f"âš ï¸ ê²½ê³ : í—¬ë©§ ë¯¸ì°©ìš© ê°ì§€! (ì‹ ë¢°ë„: {confidence:.2f})")
```

#### 6-2. í…ŒìŠ¤íŠ¸ ì¶”ë¡ 
```bash
# ì´ë¯¸ì§€ ì¶”ë¡  í…ŒìŠ¤íŠ¸
uv run python src/3_inference/inference.py \
  --model models/ppe_detection_3class/weights/best.pt \
  --input dataset/data/test/images/sample.jpg
```

---

### Phase 7: ë¬¸ì„œí™” ğŸ“

#### 7-1. README.md ì—…ë°ì´íŠ¸
- [x] í´ë˜ìŠ¤ ì •ì˜ (2 â†’ 3)
- [x] í›ˆë ¨ ê²°ê³¼ ì—…ë°ì´íŠ¸
- [x] í´ë˜ìŠ¤ë³„ ì„±ëŠ¥ ë¶„ì„
- [x] í˜¼ë™ í–‰ë ¬ í•´ì„

#### 7-2. ë…¼ë¬¸ ì‘ì„± ìë£Œ
**í•™ìˆ ì  ì˜ì˜:**
1. **ë¬¸ì œ ì •ì˜ ëª…í™•í™”**
   - ê¸°ì¡´: ì°©ìš© ìƒíƒœë§Œ íƒì§€
   - ê°œì„ : ì°©ìš©/ë¯¸ì°©ìš© ëª¨ë‘ íƒì§€

2. **ì‹¤ìš©ì„± í–¥ìƒ**
   - ì‹¤ì‹œê°„ ì•ˆì „ ëª¨ë‹ˆí„°ë§ ê°€ëŠ¥
   - ë¯¸ì°©ìš© ì‹œ ì¦‰ê° ê²½ê³  ê°€ëŠ¥

3. **ì„±ëŠ¥ ë¹„êµ**
   - 2 class vs. 3 class ì •ëŸ‰ì  ë¹„êµ
   - Precision, Recall, mAP ë³€í™” ë¶„ì„
   - í˜¼ë™ í–‰ë ¬ë¡œ í´ë˜ìŠ¤ ê°„ í˜¼ë™ ë¶„ì„

---

## ì²´í¬ë¦¬ìŠ¤íŠ¸

### ë°ì´í„° ì¤€ë¹„
- [ ] ì›ë³¸ ë°ì´í„° ë°±ì—…
- [ ] í´ë˜ìŠ¤ ë§¤í•‘ ì¬ì •ì˜ (step3_merge_datasets.py)
- [ ] ì „ì²˜ë¦¬ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ (step1~6)
- [ ] 3 class ë°ì´í„° ê²€ì¦
- [ ] í´ë˜ìŠ¤ ë¶„í¬ í™•ì¸

### ì„¤ì • ë° í›ˆë ¨
- [ ] ppe_dataset.yaml ì—…ë°ì´íŠ¸ (nc: 3)
- [ ] train_config.yaml í™•ì¸
- [ ] MacBook í…ŒìŠ¤íŠ¸ í›ˆë ¨ (3 epochs)
- [ ] RunPod A100 ë³¸ í›ˆë ¨ (100 epochs)
- [ ] í›ˆë ¨ ê²°ê³¼ ì €ì¥ ë° ë°±ì—…

### í‰ê°€ ë° ë¶„ì„
- [ ] mAP, Precision, Recall ê³„ì‚°
- [ ] í´ë˜ìŠ¤ë³„ ì„±ëŠ¥ ë¶„ì„
- [ ] í˜¼ë™ í–‰ë ¬ í™•ì¸ (helmet vs. head)
- [ ] 2 class vs. 3 class ì„±ëŠ¥ ë¹„êµ

### ì¶”ë¡  ë° ë¬¸ì„œí™”
- [ ] ì¶”ë¡  ìŠ¤í¬ë¦½íŠ¸ ì—…ë°ì´íŠ¸
- [ ] ìƒ‰ìƒ ì½”ë“œ ë° ê²½ê³  ë¡œì§ ì¶”ê°€
- [ ] í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€ ì¶”ë¡  í™•ì¸
- [ ] README.md ì—…ë°ì´íŠ¸
- [ ] ë…¼ë¬¸ ì‘ì„± ìë£Œ ì •ë¦¬

---

## ì˜ˆìƒ ë¬¸ì œ ë° í•´ê²°ì±…

### 1. head í´ë˜ìŠ¤ ë°ì´í„° ë¶€ì¡±
**ë¬¸ì œ:** Dataset 1ì—ë§Œ head í´ë˜ìŠ¤ ì¡´ì¬
**í•´ê²°:**
- Data Augmentation ê°•í™” (rotation, flip, brightness)
- Class Weight ì¡°ì • (head í´ë˜ìŠ¤ ê°€ì¤‘ì¹˜ ì¦ê°€)
- ì¶”ê°€ ë°ì´í„°ì…‹ íƒìƒ‰ (Roboflow, Kaggle)

### 2. helmet vs. head í˜¼ë™
**ë¬¸ì œ:** í—¬ë©§ê³¼ ë¨¸ë¦¬ í˜•íƒœ ìœ ì‚¬ë¡œ ì˜¤íƒ
**í•´ê²°:**
- í›ˆë ¨ ë°ì´í„° í’ˆì§ˆ ê²€ì¦
- Augmentation ì¡°ì •
- Confidence Threshold íŠœë‹ (0.5 â†’ 0.6)

### 3. ì„±ëŠ¥ í•˜ë½
**ë¬¸ì œ:** 3 class ì¶”ê°€ë¡œ ì „ì²´ mAP í•˜ë½
**í•´ê²°:**
- Epochs ì¦ê°€ (100 â†’ 150)
- Learning Rate ì¡°ì •
- ëª¨ë¸ í¬ê¸° ì¦ê°€ (yolov8n â†’ yolov8s)

---

## íƒ€ì„ë¼ì¸

| ë‹¨ê³„ | ì˜ˆìƒ ì†Œìš” ì‹œê°„ | ë¹„ê³  |
|------|----------------|------|
| ë°ì´í„° ì¬êµ¬ì„± | 2-3ì‹œê°„ | ìŠ¤í¬ë¦½íŠ¸ ìˆ˜ì • + ì¬ì‹¤í–‰ |
| ì„¤ì • íŒŒì¼ ì—…ë°ì´íŠ¸ | 30ë¶„ | YAML, config ìˆ˜ì • |
| ë°ì´í„° ê²€ì¦ | 1ì‹œê°„ | ì‹œê°í™” + ë¶„í¬ í™•ì¸ |
| ë¡œì»¬ í…ŒìŠ¤íŠ¸ í›ˆë ¨ | 30ë¶„ | 3 epochs MacBook |
| RunPod A100 í›ˆë ¨ | 1-1.5ì‹œê°„ | 100 epochs |
| ì„±ëŠ¥ í‰ê°€ ë° ë¶„ì„ | 2ì‹œê°„ | ê²°ê³¼ ë¶„ì„ + ë¹„êµ |
| ì¶”ë¡  ì‹œìŠ¤í…œ ì—…ë°ì´íŠ¸ | 1ì‹œê°„ | ìŠ¤í¬ë¦½íŠ¸ ìˆ˜ì • + í…ŒìŠ¤íŠ¸ |
| ë¬¸ì„œí™” | 2ì‹œê°„ | README + ë…¼ë¬¸ ìë£Œ |
| **ì´ ì˜ˆìƒ ì‹œê°„** | **10-12ì‹œê°„** | 1-2ì¼ ì‘ì—… ë¶„ëŸ‰ |

---

## ì„±ê³µ ê¸°ì¤€

### ì •ëŸ‰ì  ì§€í‘œ
- [x] 3 class mAP@0.5 â‰¥ 90%
- [x] head í´ë˜ìŠ¤ Recall â‰¥ 85%
- [x] helmet vs. head í˜¼ë™ë¥  < 10%
- [x] ì „ì²´ í›ˆë ¨ ì‹œê°„ < 2ì‹œê°„ (A100)

### ì •ì„±ì  ì§€í‘œ
- [x] í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€ì—ì„œ helmet/head ì •í™•íˆ êµ¬ë¶„
- [x] ì‹¤ì‹œê°„ ì¶”ë¡  ì‹œ ê²½ê³  ì‹œìŠ¤í…œ ì‘ë™
- [x] í˜¼ë™ í–‰ë ¬ ì‹œê°í™”ë¡œ ëª…í™•í•œ ì„±ëŠ¥ í™•ì¸
- [x] ë…¼ë¬¸ ì‘ì„±ì— ì¶©ë¶„í•œ í•™ìˆ ì  ê·¼ê±° í™•ë³´

---

## ì°¸ê³  ìë£Œ

### ê¸°ì¡´ ì—°êµ¬ (2 Class)
- README.md (í˜„ì¬ ë²„ì „)
- models/ppe_detection/ (2 class í›ˆë ¨ ê²°ê³¼)

### ë°ì´í„°ì…‹
- Hard Hat Detection (Kaggle): helmet, head, person
- Safety Helmet & Jacket (Kaggle): helmet, vest

### ê´€ë ¨ ë…¼ë¬¸
- ë”¥ ëŸ¬ë‹ ê¸°ë°˜ ì‘ì—…ì ê°œì¸ë³´í˜¸êµ¬ ì°©ìš© ë° ì–¼êµ´ ì‹ ì› í™•ì¸ ì‹œìŠ¤í…œ
- YOLO ëª¨ë¸ë³„ ê±´ì„¤ í˜„ì¥ ìœ„í—˜ ìƒíƒœ ë° ê°ì²´ ì¸ì‹ ì„±ëŠ¥ ë¹„êµ

---

## ë‹¤ìŒ ë‹¨ê³„

1. **ì¦‰ì‹œ ì‹œì‘**: ë°ì´í„° ë°±ì—… ë° í´ë˜ìŠ¤ ë§¤í•‘ ì¬ì •ì˜
2. **ìš°ì„ ìˆœìœ„**: ë°ì´í„° ì¬ì „ì²˜ë¦¬ â†’ ê²€ì¦ â†’ í…ŒìŠ¤íŠ¸ í›ˆë ¨
3. **A100 ì˜ˆì•½**: RunPod ì¸ìŠ¤í„´ìŠ¤ ì‚¬ì „ ì¤€ë¹„
4. **ê²°ê³¼ ë¶„ì„**: 2 class vs. 3 class ì„±ëŠ¥ ë¹„êµí‘œ ì‘ì„±
5. **ë…¼ë¬¸ ì‘ì„±**: í•™ìˆ ì  ì˜ì˜ ë° ì‹¤í—˜ ê²°ê³¼ ì •ë¦¬

---

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2025-11-21
**ì‘ì„±ì**: Safety Vision AI Team
**í˜„ì¬ ë¸Œëœì¹˜**: `3class` (ê¶Œì¥)
