"""
Step 5: YAML íŒŒì¼ ìƒì„±

YOLO í›ˆë ¨ì„ ìœ„í•œ ë°ì´í„°ì…‹ ì„¤ì • íŒŒì¼(ppe_dataset.yaml)ì„ ìƒì„±í•©ë‹ˆë‹¤.

## YAML íŒŒì¼ì´ë€?
ë°ì´í„°ì…‹ì˜ êµ¬ì¡°ì™€ í´ë˜ìŠ¤ ì •ë³´ë¥¼ ì •ì˜í•˜ëŠ” ì„¤ì • íŒŒì¼ì…ë‹ˆë‹¤.
YOLO ëª¨ë¸ì´ í›ˆë ¨í•  ë•Œ ì´ íŒŒì¼ì„ ì½ì–´ì„œ ë‹¤ìŒ ì •ë³´ë¥¼ íŒŒì•…í•©ë‹ˆë‹¤:
- ì´ë¯¸ì§€ê°€ ì–´ë””ì— ìˆëŠ”ì§€ (train/val/test ê²½ë¡œ)
- ëª‡ ê°œì˜ í´ë˜ìŠ¤ë¥¼ íƒì§€í• ì§€ (nc: number of classes)
- ê° í´ë˜ìŠ¤ì˜ ì´ë¦„ì´ ë¬´ì—‡ì¸ì§€ (names: helmet, vest ë“±)

## ì–¸ì œ ì‚¬ìš©ë˜ë‚˜ìš”?
1. ëª¨ë¸ í›ˆë ¨ ì‹œ:
   ```python
   from ultralytics import YOLO
   model = YOLO('yolov8n.pt')
   model.train(data='configs/ppe_dataset.yaml', epochs=100)
   ```

2. ëª¨ë¸ ê²€ì¦ ì‹œ:
   ```python
   model.val(data='configs/ppe_dataset.yaml')
   ```

3. ëª¨ë¸ ì¶”ë¡  ì‹œ (í´ë˜ìŠ¤ ì´ë¦„ ì°¸ì¡°):
   ```python
   results = model.predict(source='image.jpg')
   ```

## ì™œ ìƒëŒ€ ê²½ë¡œë¥¼ ì‚¬ìš©í•˜ë‚˜ìš”?
- ì ˆëŒ€ ê²½ë¡œ: /Users/joonho/workspace/.../images
  â†’ ë‹¤ë¥¸ ê°œë°œì PCì—ì„œëŠ” ê²½ë¡œê°€ ë‹¤ë¥´ë¯€ë¡œ ì‘ë™ ì•ˆ í•¨
- ìƒëŒ€ ê²½ë¡œ: ../images (configs í´ë” ê¸°ì¤€)
  â†’ í”„ë¡œì íŠ¸ë§Œ ë³µì‚¬í•˜ë©´ ì–´ë””ì„œë“  ì‘ë™

## YAML íŒŒì¼ êµ¬ì¡°
```yaml
path: ../images          # ë°ì´í„°ì…‹ ë£¨íŠ¸ ê²½ë¡œ (configs ê¸°ì¤€ ìƒëŒ€ ê²½ë¡œ)
train: train/images      # í›ˆë ¨ ì´ë¯¸ì§€ ê²½ë¡œ (path ê¸°ì¤€)
val: val/images          # ê²€ì¦ ì´ë¯¸ì§€ ê²½ë¡œ (path ê¸°ì¤€)
test: test/images        # í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€ ê²½ë¡œ (path ê¸°ì¤€)
nc: 2                    # í´ë˜ìŠ¤ ìˆ˜ (number of classes)
names:
  0: helmet              # í´ë˜ìŠ¤ ID: ì´ë¦„ ë§¤í•‘
  1: vest
```

## ì…ë ¥/ì¶œë ¥
- ì…ë ¥: ì—†ìŒ (í•˜ë“œì½”ë”©ëœ ì„¤ì •)
- ì¶œë ¥: configs/ppe_dataset.yaml
"""

from pathlib import Path


def generate_yaml():
    """
    ë°ì´í„°ì…‹ YAML íŒŒì¼ ìƒì„±

    ì²˜ë¦¬ ê³¼ì •:
    1. ê²½ë¡œ ì„¤ì •
    2. configs ë””ë ‰í† ë¦¬ ìƒì„±
    3. YAML ë‚´ìš© ì‘ì„± (ìƒëŒ€ ê²½ë¡œ ì‚¬ìš©)
    4. íŒŒì¼ ì €ì¥
    5. ê²°ê³¼ ì¶œë ¥

    Returns:
        Path: ìƒì„±ëœ YAML íŒŒì¼ ê²½ë¡œ
    """

    # =========================================================================
    # 1. ê²½ë¡œ ì„¤ì •
    # =========================================================================
    # í”„ë¡œì íŠ¸ ë£¨íŠ¸ ë””ë ‰í† ë¦¬
    base_dir = Path(__file__).parent.parent.parent
    # ì„¤ì • íŒŒì¼ì„ ì €ì¥í•  ë””ë ‰í† ë¦¬
    config_dir = base_dir / 'configs'

    # =========================================================================
    # 2. ì„¤ì • ë””ë ‰í† ë¦¬ ìƒì„±
    # =========================================================================
    config_dir.mkdir(parents=True, exist_ok=True)

    print("=" * 50)
    print("Step 5: YAML íŒŒì¼ ìƒì„±")
    print("=" * 50)

    # =========================================================================
    # 3. YAML ë‚´ìš© ì‘ì„±
    # =========================================================================
    # ìƒëŒ€ ê²½ë¡œ ì‚¬ìš© - configs í´ë” ê¸°ì¤€
    # ../imagesëŠ” configsì˜ ìƒìœ„ í´ë”ì— ìˆëŠ” images í´ë”ë¥¼ ì˜ë¯¸
    yaml_content = """# PPE Detection Dataset Configuration
# Generated by step5_generate_yaml.py

# ë°ì´í„°ì…‹ ê²½ë¡œ (configs í´ë” ê¸°ì¤€ ìƒëŒ€ ê²½ë¡œ)
# YOLOëŠ” ì´ pathë¥¼ ê¸°ì¤€ìœ¼ë¡œ train/val/test ê²½ë¡œë¥¼ ì°¾ìŒ
path: ../images

# ë°ì´í„° ë¶„í• 
# path ì•„ë˜ì˜ í•˜ìœ„ ê²½ë¡œë¥¼ ì§€ì •
train: train/images      # path/train/images â†’ images/train/images
val: val/images          # path/val/images â†’ images/val/images
test: test/images        # path/test/images â†’ images/test/images

# í´ë˜ìŠ¤ ìˆ˜ (number of classes)
nc: 2

# í´ë˜ìŠ¤ ì´ë¦„
# YOLOëŠ” ë¼ë²¨ íŒŒì¼ì˜ class_id (0, 1, ...)ë¥¼ ì´ ì´ë¦„ìœ¼ë¡œ ë§¤í•‘
names:
  0: helmet              # class_id 0 â†’ "helmet"
  1: vest                # class_id 1 â†’ "vest"
"""

    # =========================================================================
    # 4. íŒŒì¼ ì €ì¥
    # =========================================================================
    yaml_path = config_dir / 'ppe_dataset.yaml'
    with open(yaml_path, 'w') as f:
        f.write(yaml_content)

    # =========================================================================
    # 5. ê²°ê³¼ ì¶œë ¥
    # =========================================================================
    print(f"âœ… YAML íŒŒì¼ ìƒì„± ì™„ë£Œ!")
    print(f"   - ê²½ë¡œ: {yaml_path}")
    print()
    print("ğŸ“„ íŒŒì¼ ë‚´ìš©:")
    print("-" * 40)
    print(yaml_content)
    print()

    return yaml_path


if __name__ == '__main__':
    # ìŠ¤í¬ë¦½íŠ¸ ì§ì ‘ ì‹¤í–‰ ì‹œ YAML ìƒì„±
    generate_yaml()
